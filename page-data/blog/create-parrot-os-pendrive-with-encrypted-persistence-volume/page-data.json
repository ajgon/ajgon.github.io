{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/create-parrot-os-pendrive-with-encrypted-persistence-volume/","result":{"data":{"allFile":{"edges":[{"node":{"publicURL":"/static/c572c87cb69383ddb09f62960f02f969/browserconfig.xml"}}]},"site":{"siteMetadata":{"siteUrl":"https://www.rzegocki.pl"}},"avatar":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEu0lEQVQ4y22TfUxTVxjGD72lvW1HZclIJrqZGEw0WZj7Y8syp4ssaJxzcQzUhSBuOkDUyVCZVScyCDGo4LbAdMvAzKhj0MqHVYdGlA0HEwXlswhFgTKnFtoi2N57e56d25VWzd7kyXs+f/c57zmXEBYqlconjuOIVqslarVa7qtYns+0iamc6VOmGUwqnud9a5gUT7RJIPwAEh0dTRYvXiz3NzNZ2GI8IxfTLaYKNv+6H8T9L1D+mj+/ouZ5qtFoZIBXFRrqZWMiMybJULVKBdaX51qYiYgn98qmAnY1PK9gEMIWHmVtKDjOrVCq6PTISKrV6WhYmJ6qeQ3VTwuXdDqd2w+99EJEhA/0LNBXC16jmcfaQmioCpEzZtKDe7dQQ0YK/ThhJZbGxmDFslianLiKznzpZcrqLfocq9UJU4wgkFdzSnYhGl6dqVLzWPLuO+KFk4UYbCilV8oL0VBRhFZzCRpZPl+WR3N2pNEXp88Q/S6PyQyWfccmUx1/OU1zZs9Ce12pKHQZ0ddSB0huwNkP3G8DIMLWdRWTHUZ8m/uFSBRKaDWaI0qlMgj0n38KuOiN+fNEr6UagvUSZQQIEsWYwwmH04lHE4/lIUptTdTVeorOjZoFtmeB/2KDwLDndIEbLyvY1iH1mCAMNUny5sceEQ/vDWHcbsPomNMH9Iy0SeitwgHDZ9dZn8gKPB0ZKA9Mdp7mYLtApN7aE0JPFYRes+h1jYAKk5AGGyEM1LPje+B1uyD2XxDdXSZMdJwummg3koctv3BPvUM5hJ5qhae7mjhvVsSKlhp4uk9TobuKym1Ya4GBWoi9tRAstZTNQeqtkZxtFa8JlhrZhO+VBCJ67mzm8i4ZaC5X3G/9lYy3m35GnxmSpUYcvVGOeuOPuGQqg/1GJby9NSK9fQbDzadKu+qPkp4rpdyS5OUkKioqCPR6vSR99yYyZ00S0b35KpeWtaHhoqmIOTsr4c551J84AGNJDnN5Dug3e83lB7EuI8kaE78wImZNLFmV8mEIpTQIlGt47/4INz7uJC7X2OqbnW3IKdwnFRfvodfrfoCt+RSGm07i6pliHP7GgD0Fu4XGv37HnUFrpvVuH+m+3cnJjKeAbo+ocHskuV0pX2VtXZW4dmsSNhrSkJf3CfJzk5G+MwXJGcn0eOUx+QXIcQ3Di9iem+Qp4NDQcEhX3yDp7BsOd9gfWCddozh0pMC78csNNDN7C83NXod9uxKxPXsT0g0pNLcomzrtI7A/uOcZc03Mc45PEofDoQgAm/+4HPLT2XZScqZTP9pu/vvRLSO+3r9DSs1KgSEvjX5XvB6Fh9dj7/5UbNyZQvMLsryeDhPGLRcdzX2OyBtWBxnovx0SABqqncTefk4BWyOB1Zz2J/tvs3K3Yhv7vXIOfS4dKkn3Fn2fTvMPb6YZ+7ZSQ36m2MDqaWs6vr3naiVpu1LO9Qzag0f+4Lf/Xntq+gaF8ehXJCZhxYKFMW8Ly1YuQVziSsSvXYWEdatZjkfC2jgsj1uGpR+9V0U8CNlVf5C8nxpH7trFINB6udSXFYSbsv0Wr+RbtSrtdb027Fq4flo308Pn9eF2vU7/j06toypFaCUrWuCYLefKfPlfC5bF+yGL26YAAAAASUVORK5CYII=","width":192,"height":192,"src":"/static/288480e5b155377d1ae8a338e27da1ef/f20a7/ajgon.png","srcSet":"/static/288480e5b155377d1ae8a338e27da1ef/f20a7/ajgon.png 1x,\n/static/288480e5b155377d1ae8a338e27da1ef/6c7c3/ajgon.png 1.5x,\n/static/288480e5b155377d1ae8a338e27da1ef/6a040/ajgon.png 2x"}}},"allMenuJson":{"edges":[{"node":{"id":"2e6028ce-fad1-487b-bace-6117f33e393f","name":"About","to":"about"}},{"node":{"id":"27dd36a1-f8af-4d43-8bab-c37310058c1e","name":"Technologies","to":"technologies"}},{"node":{"id":"447e8185-ac1a-42bc-a28c-4bc90e52735a","name":"Blog","to":"blog"}},{"node":{"id":"a9fc4afa-7b78-44d2-b015-4dac2ac2afe8","name":"Contact","to":"contact"}}]},"allShareJson":{"edges":[{"node":{"id":"2f0a723b-2772-40bf-9edc-70dd70337f10","slug":"facebook","name":"Facebook","url":"https://www.facebook.com/sharer/sharer.php?u=%POSTURL%;display=popup","width":626,"height":457}},{"node":{"id":"f5678f7f-ae05-444a-af1a-1167a30d0cce","slug":"linkedin","name":"LinkedIn","url":"https://www.linkedin.com/shareArticle?mini=true&amp;url=%POSTURL%&amp;title=","width":600,"height":450}},{"node":{"id":"4cbf0a18-d389-4583-98ac-501e59f1be18","slug":"twitter","name":"Twitter","url":"https://twitter.com/share?url=%POSTURL%&amp;text=","width":500,"height":550}}]},"allSocialJson":{"edges":[{"node":{"id":"587d3ac1-40e9-4cc1-a610-f8cb9657bfbc","name":"GitHub","slug":"github","url":"https://github.com/ajgon"}},{"node":{"id":"d97c572d-7410-413c-89bd-ee620e901fce","name":"LinkedIn","slug":"linkedin","url":"https://www.linkedin.com/in/ajgon"}},{"node":{"id":"6928828d-8198-4387-a5f6-3a1036179c08","name":"Keybase","slug":"keybase","url":"https://keybase.io/ajgon"}}]},"markdownRemark":{"html":"<p>Apart from working as a developer, I also do some server administration in my spare time. Mostly as a devops for projects which I write, but also I <a href=\"/blog/build-your-own-cloud-fast-thanks-to-ansible-and-automation/\">host</a> <a href=\"/blog/adding-email-server-autoconfig-and-autodiscover/\">my</a> <a href=\"/blog/setting-encrypted-backup-email-server/\">own</a> <a href=\"/blog/installing-custom-linux-on-raspberry-pi-2/\">server</a> with mail, git etc. I keep a lot of private info there, so naturally I had to learn a lot about securing it and keeping it as safe as possible.</p>\n<p>However I always did it from \"defendant\" perspective, and learned techniques connected mostly with that (closing ports, configuring firewalls etc.). Recently I came to conclusion, that this may be not enough - I have to start thinking as an attacker, to better understand the tools and tricks used in todays cyberworld.</p>\n<p>To do that, I started reading security blogs, collecting tools and playing with self-prepared vulnerable virtual machines. Really quickly my laptop got filled with a lot of stuff which I used to play with, adding more and more mess. And as a programmer, with strong belief in \"Single responsibility principle\", I didn't like that - my base system should be used only for my daily needs and I need to separate my \"hacker wanna be\" activities. So, naturally I started looking for some specialised Linux distro just for that.</p>\n<p>Everybody heard about Kali Linux (formerly known as BackTrack), so naturally I started there. And I didn't like what I found - it felt bloated, sluggish - more like \"Debian + pentesting friends\" instead of a distro built from scratch with hacking principle in mind. A lot of people use it, and are happy for it - but for me it didn't feel right.</p>\n<p>And then I discovered Parrot OS, and immediately felt in love with it. It's beautiful (when you work a lot with designers, at some point you start noticing things like that), fast, has all the tools and as a bonus - it's built from scratch with privacy in mind.</p>\n<p>Setting up a pendrive with Live distro is a breeze - just download ISO, and flash it. However it gets a little wild, when you want to set a permanent, encrypted storage for it. Hence this guide.</p>\n<h2>Step 1: Flash Parrot OS to pendrive</h2>\n<p>This step is pretty simple and self explanatory - just download the ISO and flash it. There are plenty, fancy tools for that, but good, old <code class=\"language-text\">dd</code> is still best suited for the job.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=alice data-host=localhost></span></span><span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>Parrot-security-4.6_amd64.iso <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span>/dev/rdisk2 <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span>1m</code></pre></div>\n<p>On OSX, it is important to use <code class=\"language-text\">/dev/rdiskX</code> instead of <code class=\"language-text\">/dev/diskX</code> as it provides raw (thus way faster) access to the device. On Linux, just pass <code class=\"language-text\">/dev/sdX</code> as you normally do.</p>\n<h2>Step 2: Partition the pendrive</h2>\n<p>Okay, we have our distro set up, let's give it a spin! You may notice many <code class=\"language-text\">GRUB</code> options, but for now - let's go with basic, Live USB.</p>\n<h3>Dealing with gparted and ISO partition</h3>\n<blockquote>\n<p>This was an issue at the time of writing this article, with <code class=\"language-text\">gparted</code> versions above <code class=\"language-text\">0.28</code>. If it doesn't apply to you, you can skip this section.</p>\n</blockquote>\n<blockquote>\n<p>You can also create a partition using good, old <code class=\"language-text\">fdisk</code> which handles this case properly.</p>\n</blockquote>\n<p>The next step is to partition the disk - you will notice something odd, immediately after starting <code class=\"language-text\">gparted</code> and switching to your pendrive.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2396fcd5d6059a37579a11b7fee2ec98/64639/parrot-gparted-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB8ElEQVQ4y62Sy27TQBSG/SC0TpEiz4ztJmAT2wnBxUgIKLDmVRBCCImLSgM0SWmSQhAgVihJq5AiYkCw4wmIFyDYQzcs2FAnhzPjIVWlVCUSi0//uf5jjUe5eOZ08/yl4IOdC/qWdyq0JZYbhHn/bFg4uRh6XBcWw2JwQWjePyf62WN+mLF9rn3Ud1nbbymOF3yzCz5krAUwj/rICTCOJOjZImiGByxzXMTEzCOeqKWZg/UCmJaPs0WYt8TuL+XZ8xef2p0t6Gz0frc63bjV7sbtzssY80Q3e/Gj5tN4/eETWd/tdXv9uP/mffzq9dsdVNjY7H1XytV6VGs8hrV6c1hPFO6Xa7C0XIaVSg3K1QZcvXYTLl+5DpXVBpTurcJSqQLVB+uif/vOCizfrY54fuNWaVshlEVMN4AxY0ipDppGIZ3W4NCMCrOzKRFrhIGaOgyqOgczWOM9NTU3zpERz3F+W6GURIQQQIZcMUco6IzhIUzEvMYYlTDZS3I5NxKxzrghjZIlOpQ6hh+g6zqYpgnJYXQ/RlITQzk80XBSPMlQ9vc3/Gsgr+Mg04MN//sXTskew4Es7nBT/rcTczIFNJaGPxSNkC+ahm9NQsjuvf074yv5qTiuu+U4zlfXdQe5XC7CZxIZhoE6FQPkM+59/AOXkc/PR79k2wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parrot gparted 1\"\n        title=\"parrot gparted 1\"\n        src=\"/static/2396fcd5d6059a37579a11b7fee2ec98/5a190/parrot-gparted-1.png\"\n        srcset=\"/static/2396fcd5d6059a37579a11b7fee2ec98/772e8/parrot-gparted-1.png 200w,\n/static/2396fcd5d6059a37579a11b7fee2ec98/e17e5/parrot-gparted-1.png 400w,\n/static/2396fcd5d6059a37579a11b7fee2ec98/5a190/parrot-gparted-1.png 800w,\n/static/2396fcd5d6059a37579a11b7fee2ec98/c1b63/parrot-gparted-1.png 1200w,\n/static/2396fcd5d6059a37579a11b7fee2ec98/64639/parrot-gparted-1.png 1568w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Whole disk is occupied by mysterious \"iso\" volume, despite the fact the image was only 4GB! Clearly, something is wrong with partition table. Let's check offsets with wipefs:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span><span></span><span></span><span></span></span>wipefs /dev/sdb\nDEVICE OFFSET      TYPE    UUID                   LABEL\nsdb    0x8001      iso9660 <span class=\"token number\">2019</span>-04-25-11-04-24-00 Parrot OS\nsdb    0x1fe       dos\nsdb    0x3ba2ffe00 gpt</code></pre></div>\n<p>You may notice, that <code class=\"language-text\">/dev/sdb</code> contains signatures of two (or three) different data structures - an ISO image written to the whole disk, a DOS partition table, and optinally - a GPT partition scheme signature. When you check your drive with <code class=\"language-text\">blkid</code>...</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span></span>blkid /dev/sdb\n/dev/sdb: <span class=\"token assign-left variable\">UUID</span><span class=\"token operator\">=</span><span class=\"token string\">\"2019-04-25-11-04-24-00\"</span> <span class=\"token assign-left variable\">LABEL</span><span class=\"token operator\">=</span><span class=\"token string\">\"Parrot OS\"</span> <span class=\"token assign-left variable\">TYPE</span><span class=\"token operator\">=</span><span class=\"token string\">\"iso9660\"</span> <span class=\"token assign-left variable\">PTUUID</span><span class=\"token operator\">=</span><span class=\"token string\">\"f3dc8ed4\"</span> <span class=\"token assign-left variable\">PTTYPE</span><span class=\"token operator\">=</span><span class=\"token string\">\"dos\"</span></code></pre></div>\n<p>... you will notice, that ISO partition is the preferred one. That's why gparted gets crazy and reports it as a whole drive. Thankfully, the fix is pretty easy - just wipe out information about ISO:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span></span>wipefs -o 0x8001 -f /dev/sdb\n/dev/sdb: <span class=\"token number\">5</span> bytes were erased at offset 0x00008001 <span class=\"token punctuation\">(</span>iso9660<span class=\"token punctuation\">)</span>: <span class=\"token number\">43</span> <span class=\"token number\">44</span> <span class=\"token number\">30</span> <span class=\"token number\">30</span> <span class=\"token number\">31</span></code></pre></div>\n<p>Since you will be altering already mounted partition, don't forget <code class=\"language-text\">-f</code> flag to force the overwrite. After that, <code class=\"language-text\">gparted</code> should start reporting partition and free space correctly.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7b0f9cb8379258cea257b980d29040a0/64639/parrot-gparted-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACYUlEQVQ4y5WRy08TURjF538h2judR8tMO3OLtHTaihWJCzE+QsRECZGWvmwJjwDKI0JQE0klxBgTF0IiYeHGBZOYuPMvkFlodK/duHADMz3eDtPaYCSw+OWc+33fPffeXO5yuvdV/3Xjoxo2dlWaNBsoesJUNMOk0bTZ1dNnRmJM433mOeOSSWMX3bqiG2ZAjZmyGmXEdpl+YLrDaTTxPdwdh6qnIKtxyEoPFC0FRU+iU0tAYusmgVAcwbDhzgnBbrY2oNIUOtmsGnH3/ObebO18frv9DusbL/e3Nnfs19ub9vj8lD07s2jPzi3YM7Pzrs49WLQnJmfsXP6+PT4x7dYWFpftldWn9tKj1YPllSdYWFr+wa1VN6xna+uYmn7oPK++wOPqGgqTFeTzFYxmCyiWxpEZK7l+LFfCraG7uDM8ilJ5AvliGSP3csgXKvVyZRLDI5kap4SopagUYlhx9Gg3CJEgB0IQAwo6zvAIqhpoVww+XgIvBqGEIyBCAMQvuz0poEIOhuoMdJz117j0YNHqv11B72De6Rsq4cJgEbGrWUQHskzHcP5mEY2+cS2HHrZO3ii0fMLz0SuZenQgw2rZGieIksWAIEiOq5IMP1MX4V94QWQqtnl3tu7tqXGEEIv4fOypPocBzx8DAc/zR+t1r1fjWNNqDDAcT/8LIUz9fkiSdOj/9uqeHgZ6pzrHh5GWtvtmoOdPHugGHL1t2w3bA/e84kEjlDWcw3ByCnjbC/zJ+Qj56mMf0aRxcvNZJ6f1/F+cTul7Xde/UUr3NE2zBEGwRFFkeir2GF/Yvk9/ADRnz3VlpBGGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parrot gparted 2\"\n        title=\"parrot gparted 2\"\n        src=\"/static/7b0f9cb8379258cea257b980d29040a0/5a190/parrot-gparted-2.png\"\n        srcset=\"/static/7b0f9cb8379258cea257b980d29040a0/772e8/parrot-gparted-2.png 200w,\n/static/7b0f9cb8379258cea257b980d29040a0/e17e5/parrot-gparted-2.png 400w,\n/static/7b0f9cb8379258cea257b980d29040a0/5a190/parrot-gparted-2.png 800w,\n/static/7b0f9cb8379258cea257b980d29040a0/c1b63/parrot-gparted-2.png 1200w,\n/static/7b0f9cb8379258cea257b980d29040a0/64639/parrot-gparted-2.png 1568w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Partition the free space</h3>\n<p>This is pretty straightforward - create a new partition over free space, set it's type to <code class=\"language-text\">ext4</code> and label to <code class=\"language-text\">persistence</code>. Then apply the changes.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6d1dbc3dc06af2ff94161bd54288c10e/dd507/parrot-gparted-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACTElEQVQoz42R2W7TQBSG/SwtiT22x9vY492Ok8ZpnGZxEzupGhASLSrqC3DDclHWUkq2pkU8APcgARKvAFKlPhAnbYHABeLXp9E/Z+Y/M5ph7KBGrIpKI80sA6pZJtaa4VSJXdHtqu4sgIpmViQSYs1fImDiJF9vDuIkixt5FHfK1TSqpm6Y/MIJ6leAryZZ0hrUNvJGewv2M9++n3/4+Onzl6/nFxej95OjV8fjyXQynY3G0/EYzMnBk6cPHj5+fTyaTGazk1NgOpvP5mcn8zPmzs5e1r+5c3d/d28/Gw7z/jBpbrbTvJdvNztZo7mZdvu1egtMPhi2Oj1YzfrbWTaorW8wflSTDQrwgoJ4WZTIyiq3WkBYJgJWV25wRU5kES6wAifIIiYi1rCiS8RCWGfW+/eoH/OChGVNwIpKzPuPnh1N3714c/r8eP5ydHY4fntwOHHDCuJFjVBJUrBqOo1bXvM2wxYLoihomqqqiqZpYRikvbzTzVrttJ12N7Os2e70t4ZwSdvxiG4CkqwUiwWOLTIIIVVRbdtxXY9SSghRVA1LsihKMIV2giBY3tpaPa/W4Tu6UdyjdsRyLOIFhuM4ONTzPNd1TdOEgGFQajqG6fpB4Hoe5INyUopTJ6y7pbpX3iDUZ9kinLoIy7IMGXwtUdX0sJxQK4A2i7mIDWrbrm+5Jd30qR2qxGJZdhFGl+KXhXjEcYjnfhcuRS3fdiNoQYw/wyBuSX9XwCMEV4V3Aq6SizC45cA/xf/kWoyu6/DCMIrwY/8t8VI/AH3k0d/VpewrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"parrot gparted 3\"\n        title=\"parrot gparted 3\"\n        src=\"/static/6d1dbc3dc06af2ff94161bd54288c10e/5a190/parrot-gparted-3.png\"\n        srcset=\"/static/6d1dbc3dc06af2ff94161bd54288c10e/772e8/parrot-gparted-3.png 200w,\n/static/6d1dbc3dc06af2ff94161bd54288c10e/e17e5/parrot-gparted-3.png 400w,\n/static/6d1dbc3dc06af2ff94161bd54288c10e/5a190/parrot-gparted-3.png 800w,\n/static/6d1dbc3dc06af2ff94161bd54288c10e/c1b63/parrot-gparted-3.png 1200w,\n/static/6d1dbc3dc06af2ff94161bd54288c10e/dd507/parrot-gparted-3.png 1528w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Step 3: Encrypt the partition</h2>\n<p>This step is optional - however, it's a good habit to encrypt everything. I see no reason for exceptions here.</p>\n<p>First, set encrypted luks volume over a newly created partition:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span>cryptsetup --verbose --verify-passphrase luksFormat /dev/sdb3\nWARNING: Device /dev/sdb3 already contains a <span class=\"token string\">'ext4'</span> superblock signature.\n\nWARNING<span class=\"token operator\">!</span>\n<span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span>\nThis will overwrite data on /dev/sdb3 irrevocably.\n\nAre you sure? <span class=\"token punctuation\">(</span>Type uppercase <span class=\"token function\">yes</span><span class=\"token punctuation\">)</span>: YES\nEnter passphrase <span class=\"token keyword\">for</span> /dev/sdb3:\nVerify passphrase:\nExisting <span class=\"token string\">'ext4'</span> superblock signature on device /dev/sdb3 will be wiped.\nKey slot <span class=\"token number\">0</span> created.\nCommand successful.</code></pre></div>\n<p>Next, attach it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span></span>cryptsetup luksOpen /dev/sdb3 my_part\nEnter passphrase <span class=\"token keyword\">for</span> /dev/sdb3:</code></pre></div>\n<p>Now we can format it or create multiple LVMs - it's up to you. Since it's a pendrive, I decided to not go crazy, and just created one <code class=\"language-text\">ext4</code> partition, filling up all the space (don't forget to label it):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span data-user=root data-host=localhost></span><span></span><span data-user=root data-host=localhost></span></span>mkfs.ext4 -L persistence /dev/mapper/my_part\n<span class=\"token function\">mke2fs</span> <span class=\"token number\">1.44</span>.5 <span class=\"token punctuation\">(</span><span class=\"token number\">15</span>-Dec-2018<span class=\"token punctuation\">)</span>\nCreating filesystem with <span class=\"token number\">2931456</span> 4k blocks and <span class=\"token number\">732960</span> inodes\nFilesystem UUID: 592d5d84-f630-4e80-9ea9-0c9973be68f4\nSuperblock backups stored on blocks:\n    <span class=\"token number\">32768</span>, <span class=\"token number\">98304</span>, <span class=\"token number\">163840</span>, <span class=\"token number\">229376</span>, <span class=\"token number\">294912</span>, <span class=\"token number\">819200</span>, <span class=\"token number\">884736</span>, <span class=\"token number\">1605632</span>, <span class=\"token number\">2654208</span>\n\nAllocating group tables: <span class=\"token keyword\">done</span>\nWriting inode tables: <span class=\"token keyword\">done</span>\nCreating journal <span class=\"token punctuation\">(</span><span class=\"token number\">16384</span> blocks<span class=\"token punctuation\">)</span>: <span class=\"token keyword\">done</span>\nWriting superblocks and filesystem accounting information: <span class=\"token keyword\">done</span>\n\ne2label /dev/mapper/my_part persistence\n\n<span class=\"token function\">mount</span> /dev/mapper/my_part /mnt</code></pre></div>\n<p>Now, we need to configure Parrot to treat this new partition as a volume which would store it's data. This is done by one line in persistence configuration file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span></span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"/ union\"</span> <span class=\"token operator\">></span> /mnt/persistence.conf</code></pre></div>\n<p>That's it! Umount the partition, and close the luks volume.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span></span><span class=\"token function\">umount</span> /mnt\ncryptsetup luksClose /dev/mapper/my_part</code></pre></div>\n<h3>Optional: Set a nuke password</h3>\n<p>Newer versions of luks provide interesting functionality - a \"nuke\" password. The idea is simple - if you are forced to reveal the password, you can provide the \"nuke\" one instead of the real thing, and your partition will be unrecoverably destroyed (thus \"nuke\").</p>\n<p>Personally I don't see any sense in it - if the forensic is smart, he would make a one to one copy as a first thing which would render nuking pointless - but hey, you can always meet somebody less sharp, and it may actually help.</p>\n<p>To add a nuke, simply invoke:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span><span></span><span></span><span></span></span>cryptsetup luksAddNuke /dev/sdb3\nEnter any existing passphrase:\nEnter new passphrase <span class=\"token keyword\">for</span> key slot:\nVerify passphrase:</code></pre></div>\n<p><strong>Note:</strong> Recent versions of Parrot have <code class=\"language-text\">luksAddNuke</code> patch removed in favor of separate <code class=\"language-text\">cryptsetup-nuke-password</code> package. To add nuke password using this, use:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=root data-host=localhost></span></span>dpkg-reconfigure cryptsetup-nuke-password</code></pre></div>\n<p>Do not mix those passwords yourself, as nuked partition is unrecoverable.</p>\n<h2>Step 4: Reboot</h2>\n<p>We're done. Reboot Parrot, and select <code class=\"language-text\">Encrypted persistence</code> option. In this mode, everything you do, will be saved to the pendrive.</p>\n<p>Now, you can wear your obligatory hoodie, play some hacker music and start nuking Gibsons!</p>\n<h3>Sources</h3>\n<ul>\n<li><a href=\"https://bugzilla.gnome.org/show_bug.cgi?id=789898\">Bug 789898 - GPT disk full of partitions looks like iso9660 with no partitions</a></li>\n<li><a href=\"https://community.parrotlinux.org/t/live-usb-with-persistence/3359/5\">Live USB with Persistence</a></li>\n</ul>","excerpt":"Apart from working as a developer, I also do some server administration in my spare time. Mostly as a devops for projects which I write, but…","frontmatter":{"id":"1beca99c-b8e7-49b9-8de6-3cda468e359e","title":"Create Parrot OS pendrive with encrypted persistence volume","date":"July 16, 2019","isoDate":"2019-07-16T16:17:34.000Z","tags":["security"],"cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAcWkGiEB/8QAGBAAAgMAAAAAAAAAAAAAAAAAARECIDH/2gAIAQEAAQUCGySp/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFhABAQEAAAAAAAAAAAAAAAAAIQAg/9oACAEBAAY/AmM//8QAGBABAAMBAAAAAAAAAAAAAAAAAQAQETH/2gAIAQEAAT8hzjqA0Ea//9oADAMBAAIAAwAAABATP//EABYRAQEBAAAAAAAAAAAAAAAAABEAAf/aAAgBAwEBPxBHIv/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAQEBAQEBAAAAAAAAAAAAAAERACExYf/aAAgBAQABPxBtBF6WXAWlSvfPmXNubHLv/9k=","aspectRatio":1.7730496453900708,"src":"/static/de9bda1a6be318975c7fab5cd99d6dd2/a7715/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg","srcSet":"/static/de9bda1a6be318975c7fab5cd99d6dd2/8f7df/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg 250w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/0f3a1/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg 500w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/a7715/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg 1000w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/37d86/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg 1500w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/0e329/create-parrot-os-pendrive-with-encrypted-persistence-volume.jpg 1600w","srcWebp":"/static/de9bda1a6be318975c7fab5cd99d6dd2/e30b5/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp","srcSetWebp":"/static/de9bda1a6be318975c7fab5cd99d6dd2/7ca0e/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp 250w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/e9589/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp 500w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/e30b5/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp 1000w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/90fb1/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp 1500w,\n/static/de9bda1a6be318975c7fab5cd99d6dd2/7c22d/create-parrot-os-pendrive-with-encrypted-persistence-volume.webp 1600w","sizes":"(max-width: 1000px) 100vw, 1000px"}}},"path":"/blog/create-parrot-os-pendrive-with-encrypted-persistence-volume/","author":"Igor Rzegocki"}}},"pageContext":{}}}