{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/setting-server-side-mail-filtering-with-sieve-and-dovecot/","result":{"data":{"allFile":{"edges":[{"node":{"publicURL":"/static/browserconfig-09e19ac7a78d68293c22953898762a5f.xml"}}]},"site":{"siteMetadata":{"siteUrl":"https://www.rzegocki.pl"}},"allMenuJson":{"edges":[{"node":{"id":"2e6028ce-fad1-487b-bace-6117f33e393f","name":"About","to":"about"}},{"node":{"id":"27dd36a1-f8af-4d43-8bab-c37310058c1e","name":"Technologies","to":"technologies"}},{"node":{"id":"447e8185-ac1a-42bc-a28c-4bc90e52735a","name":"Blog","to":"blog"}},{"node":{"id":"a9fc4afa-7b78-44d2-b015-4dac2ac2afe8","name":"Contact","to":"contact"}}]},"allShareJson":{"edges":[{"node":{"id":"2f0a723b-2772-40bf-9edc-70dd70337f10","slug":"facebook","name":"Facebook","url":"https://www.facebook.com/sharer/sharer.php?u=%POSTURL%;display=popup","width":626,"height":457}},{"node":{"id":"f5678f7f-ae05-444a-af1a-1167a30d0cce","slug":"linkedin","name":"LinkedIn","url":"https://www.linkedin.com/shareArticle?mini=true&amp;url=%POSTURL%&amp;title=","width":600,"height":450}},{"node":{"id":"4cbf0a18-d389-4583-98ac-501e59f1be18","slug":"twitter","name":"Twitter","url":"https://twitter.com/share?url=%POSTURL%&amp;text=","width":500,"height":550}}]},"markdownRemark":{"html":"<p>Leaving GMail was of the best decisions for my mail I made recently. But also a\nmost problematic one. I needed to set all the MTA architecture myself. I tested\nmany solutions out there and finally ended with postfix + dovecot\nconfiguration.  It appears that this is most stable and unproblematic one (at\nleast for now).</p>\n<!--more-->\n<p>The next feature I really missed is Gmail Server-Side mail filtering. I've got\na bunch of machines that access my mail server (computers, phones etc.) and I\nreceive lots emails from lists, friends and organizations every day. Setting\nfiltering for all of that once, was a big pain. Setting it multiple times on\nall the machines, and then be consistent about it was enormous P.I.T.A. So I\nstarted looking for solution for that problem and found\n<a href=\"https://bit.ly/2LHCioh\">Sieve</a> (and its\n<a href=\"https://wiki.dovecot.org/LDA/Sieve\">dovecot plugin</a>).</p>\n<p>Ok, so how to do it? Firstly, as for dovecot 1.2.x, sieve was completely\nrewritten as a new plugin. It can be obtained from\n<a href=\"https://web.archive.org/web/20121217015336/http://www.rename-it.nl/dovecot/1.2/\">rename-it.nl website</a>.\nAt the time of writing this post, there is no <code class=\"language-text\">*.deb</code> package in repositories,\nso I have to build it manually. I also had to install <code class=\"language-text\">dovecot-dev</code> package,\nbecause of sieve configurator, which needs a <code class=\"language-text\">dovecot-config</code> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=alice data-host=localhost></span><span data-user=alice data-host=localhost></span><span data-user=alice data-host=localhost></span><span data-user=alice data-host=localhost></span><span data-user=alice data-host=localhost></span><span data-user=alice data-host=localhost></span></span><span class=\"token function\">wget</span> http://www.rename-it.nl/dovecot/1.2/dovecot-1.2-sieve-0.1.19.tar.gz\n<span class=\"token function\">tar</span> -xzvf dovecot-1.2-sieve-0.1.19.tar.gz\n<span class=\"token builtin class-name\">cd</span> dovecot-1.2-sieve-0.1.19\n./configure --with-dovecot<span class=\"token operator\">=</span>/usr/lib/dovecot/ --prefix<span class=\"token operator\">=</span>/usr\n<span class=\"token function\">make</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span></code></pre></div>\n<p>After that, it was a time to enable sieve plugin in dovecot.\n<code class=\"language-text\">/etc/dovecot/dovecot.conf</code></p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\">protocol lda {\n    ...\n    # Support for dynamically loadable plugins. mail_plugins is a space separated\n    # list of plugins to load.\n    mail_plugins = sieve # ... other plugins like quota\n    # add those directives when you expect problems - huge time saver!\n    debug = yes\n    log_path = /var/log/dovecot-lda.log\n    info_log_path = /var/log/dovecot-lda.log\n}</code></pre></div>\n<p>There is a possibility to make some adjustments for plugin itself (filters\npaths and so on), but I didn't find it necessary. However, if you want to - you\ncan check them on\n<a href=\"https://wiki.dovecot.org/LDA/Sieve/Dovecot\">LDA/Sieve documentation page</a>.\nAfter that, just restart postfix and everything is set.</p>\n<p>The last step is setting all the filters properly. They should be stored in\n<code class=\"language-text\">~/.dovecot.sieve</code> (if you use <code class=\"language-text\">mailbox_command</code>) or in\n<code class=\"language-text\">/home/vmail/user@domain/.dovecot.sieve</code> (if you use <code class=\"language-text\">mailbox_transport</code>).\nSieve uses it's own <a href=\"https://www.ietf.org/rfc/rfc5228.txt\">pseudo-language</a> for\nfiltering, but below is a part of my file which should provide a\n<a href=\"https://wiki.dovecot.org/LDA/Sieve/\">good example</a> for start:</p>\n<p><code class=\"language-text\">.dovecot.sieve</code></p>\n<div class=\"gatsby-highlight\" data-language=\"none\"><pre class=\"language-none\"><code class=\"language-none\"># Require plugin for moving messages (fileinto) and vacation responder (vacation)\nrequire [\"fileinto\", \"vacation\"];\n\n# Move all mails with \"List-Id\" equal to \"users-pl.lists.rootnode.net\" to rzegocki_pl/lists IMAP directory\nif header :contains \"List-Id\" \"users-pl.lists.rootnode.net\" { fileinto \"rzegocki_pl.lists\"; stop; }\n\n# If messages are not from a list (most of the lists sets mail header \"Precedence\" either to \"list\" or \"bulk\") then send a vacation email\nif not header :contains \"Precedence\" [\"bulk\",\"list\"] {\n    vacation :days 7 :addresses [\"igor@email1.com\", \"igor@email2.com\"] :subject \"Vacation 15.07 - 22.07\" \" ..... \"\n}\n\n# Move all messages from my father to one directory\nif anyof (\n    address :is \"sender\" \"steven@email1.com\",\n    address :is \"sender\" \"steven@email2.com\",\n    address :is \"sender\" \"steven@email3.com\") {\n        fileinto \"rzegocki_pl.private.steven\"; stop;\n    }</code></pre></div>\n<p>It took me some time to set everything up (mostly because of lack of\ndocumentation and multiple domain problems), but the final effect is awesome,\nand confirms that own server is an really, really great idea :)</p>","excerpt":"Leaving GMail was of the best decisions for my mail I made recently. But also a\nmost problematic one. I needed to set all the MTAâ€¦","frontmatter":{"title":"Setting server-side mail filtering with sieve and dovecot","date":"July 16, 2012","isoDate":"2012-07-16T09:43:00.000Z","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAf/EABYBAQEBAAAAAAAAAAAAAAAAAAIBA//aAAwDAQACEAMQAAABVZPUKoweP//EABoQAQEAAgMAAAAAAAAAAAAAAAEAAhIDETH/2gAIAQEAAQUC2G2y6bjBkS9v/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Bh//EABoQAAICAwAAAAAAAAAAAAAAAAERABACITH/2gAIAQEABj8CQQMWqWK67//EABwQAQACAQUAAAAAAAAAAAAAAAEAIUEQEVFhof/aAAgBAQABPyEovJlFKOhiubhUMHmiOU//2gAMAwEAAgADAAAAEOg//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERITH/2gAIAQMBAT8QprCD/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAh/9oACAECAQE/EIK//8QAHRABAAMAAQUAAAAAAAAAAAAAAQARITFBYXGBkf/aAAgBAQABPxBMJXbY+CAGkAaPaxpdz5Y3SHLk6/YoLSdtqKwMGf/Z","aspectRatio":1.2412121212121212,"src":"/static/1315f473cccff0bf5dfdfb405c9b6175/2f7e7/setting-server-side-mail-filtering-with-sieve-and-dovecot.jpg","srcSet":"/static/1315f473cccff0bf5dfdfb405c9b6175/4d406/setting-server-side-mail-filtering-with-sieve-and-dovecot.jpg 250w,\n/static/1315f473cccff0bf5dfdfb405c9b6175/32ee9/setting-server-side-mail-filtering-with-sieve-and-dovecot.jpg 500w,\n/static/1315f473cccff0bf5dfdfb405c9b6175/2f7e7/setting-server-side-mail-filtering-with-sieve-and-dovecot.jpg 1000w,\n/static/1315f473cccff0bf5dfdfb405c9b6175/426ce/setting-server-side-mail-filtering-with-sieve-and-dovecot.jpg 1024w","sizes":"(max-width: 1000px) 100vw, 1000px"}}},"path":"/blog/setting-server-side-mail-filtering-with-sieve-and-dovecot/","author":"Igor Rzegocki"}}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}